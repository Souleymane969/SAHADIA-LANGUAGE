#!/usr/bin/env python3
"""
SAHADIA LANGUAGE - Official Launcher
Version 1.0.0
"""
import sys
import os
import subprocess
from pathlib import Path

def main():
    # Configuration
    PROJECT_ROOT = Path(__file__).parent
    COMPILER_PATH = PROJECT_ROOT / "compiler" / "scl.py"
    
    # V√©rification de l'environnement
    if not COMPILER_PATH.exists():
        print("‚ùå Erreur : Le compilateur SCL est introuvable.")
        print(f"   Cherch√© √† : {COMPILER_PATH}")
        sys.exit(1)
    
    # Gestion des arguments
    if len(sys.argv) < 2:
        print_help()
        sys.exit(0)
    
    command = sys.argv[1]
    
    if command == "run":
        if len(sys.argv) < 3:
            print("‚ùå Usage : sahadia run <fichier.sl>")
            sys.exit(1)
        run_file(sys.argv[2])
    elif command == "compile":
        if len(sys.argv) < 3:
            print("‚ùå Usage : sahadia compile <fichier.sl> [--output fichier.py]")
            sys.exit(1)
        compile_file(sys.argv[2], sys.argv[3] if len(sys.argv) > 3 else None)
    elif command == "version":
        print_version()
    elif command == "help":
        print_help()
    else:
        print(f"‚ùå Commande inconnue : {command}")
        print_help()
        sys.exit(1)

def run_file(filename):
    """Ex√©cute un fichier SAHADIA"""
    try:
        # Convertir en chemin absolu
        filepath = Path(filename).absolute()
        
        # V√©rifier l'existence
        if not filepath.exists():
            print(f"‚ùå Fichier introuvable : {filename}")
            sys.exit(1)
        
        # Construire la commande Python
        import sys
        sys.path.insert(0, str(Path(__file__).parent))
        
        from compiler.scl import transpile_to_python
        python_code = transpile_to_python(filepath.read_text())
        
        # Ex√©cuter le code Python g√©n√©r√©
        exec(python_code, {})
        
    except Exception as e:
        print(f"‚ùå Erreur d'ex√©cution : {e}")
        sys.exit(1)

def compile_file(filename, output=None):
    """Compile un fichier SAHADIA en Python"""
    try:
        filepath = Path(filename).absolute()
        
        if not filepath.exists():
            print(f"‚ùå Fichier introuvable : {filename}")
            sys.exit(1)
        
        import sys
        sys.path.insert(0, str(Path(__file__).parent))
        
        from compiler.scl import transpile_to_python
        python_code = transpile_to_python(filepath.read_text())
        
        # D√©terminer le fichier de sortie
        if output:
            outpath = Path(output)
        else:
            outpath = filepath.with_suffix(".py")
        
        # √âcrire le fichier
        outpath.write_text(python_code)
        print(f"‚úÖ Fichier compil√© : {outpath}")
        
    except Exception as e:
        print(f"‚ùå Erreur de compilation : {e}")
        sys.exit(1)

def print_version():
    """Affiche la version"""
    print("üïäÔ∏è  SAHADIA LANGUAGE v1.0.0")
    print("   Un langage humain, √©motionnel et ultra-simple.")
    print("   In memory of Sahadia.")

def print_help():
    """Affiche l'aide"""
    print("""
üïäÔ∏è  SAHADIA LANGUAGE - Lanceur Officiel

Usage:
  sahadia <commande> [arguments]

Commandes disponibles:
  run <fichier.sl>      Ex√©cute un fichier SAHADIA
  compile <fichier.sl>  Compile en fichier Python
  version              Affiche la version
  help                 Affiche ce message

Exemples:
  sahadia run hello.sl
  sahadia compile mon_programme.sl --output sortie.py
  sahadia version

Pour plus d'informations : https://github.com/Souleymane969/SAHADIA-LANGUAGE
    """)

if __name__ == "__main__":
    main()
